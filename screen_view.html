<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Screen Stream</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #181818;
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        #screen {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            display: none;
        }
        #status {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 14px;
        }
        #initial-message {
            padding: 20px;
        }
    </style>
</head>
<body>

    <img id="screen" src="" alt="–≠–∫—Ä–∞–Ω –ü–ö"/>
    <div id="initial-message">
        <h1>–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞</h1>
        <p>–î–ª—è –Ω–∞—á–∞–ª–∞ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏, –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ —á–∞—Ç —Å –±–æ—Ç–æ–º –∏ –Ω–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é" –≤ –ü–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.</p>
    </div>
    <div id="status">‚ö™ –û–∂–∏–¥–∞–Ω–∏–µ...</div>

    <script>
        // ### –í–ê–ñ–ù–û: –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –≤–∞—à –ø—É–±–ª–∏—á–Ω—ã–π WSS –∞–¥—Ä–µ—Å –æ—Ç ngrok ###
        const NGROK_WSS_URL = "wss://unillusory-betsey-nonsecretively.ngrok-free.dev"; 
        // ### -------------------------------------------------- ###

        const statusElement = document.getElementById('status');
        const screenElement = document.getElementById('screen');
        const initialMessageElement = document.getElementById('initial-message');
        let socket;

        function connect() {
            statusElement.textContent = 'üü° –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
            const fullUrl = NGROK_WSS_URL + "/stream";
            console.log(`–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ${fullUrl}`);

            try {
                socket = new WebSocket(fullUrl);

                socket.onopen = function() {
                    console.log("–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ.");
                    statusElement.textContent = '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
                    statusElement.style.color = '#76ff7a';
                };

                socket.onmessage = function(event) {
                    const imageData = event.data;
                    screenElement.src = 'data:image/jpeg;base64,' + imageData;

                    if (screenElement.style.display === 'none') {
                        screenElement.style.display = 'block';
                        initialMessageElement.style.display = 'none';
                    }
                };

                socket.onclose = function(event) {
                    console.log('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ. –ö–æ–¥: ' + event.code);
                    statusElement.textContent = 'üî¥ –û—Ç–∫–ª—é—á–µ–Ω–æ';
                    statusElement.style.color = '#ff7676';
                    setTimeout(connect, 3000);
                };

                socket.onerror = function(error) {
                    console.error('–û—à–∏–±–∫–∞ WebSocket:', error);
                    statusElement.textContent = '‚ùå –û—à–∏–±–∫–∞';
                    statusElement.style.color = '#ff7676';
                };

            } catch (e) {
                console.error("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å WebSocket:", e);
                statusElement.textContent = '‚ùå –û—à–∏–±–∫–∞';
                statusElement.style.color = '#ff7676';
            }
        }
        
        Telegram.WebApp.ready();
        connect();

    </script>
</body>
</html>

